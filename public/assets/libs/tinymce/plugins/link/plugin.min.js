!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager");let t=e=>l=>(e=>{var l,a;let c=typeof e;return null===e?"null":"object"===c&&Array.isArray(e)?"array":"object"===c&&((l=String).prototype.isPrototypeOf(e)||(null===(a=e.constructor)||void 0===a?void 0:a.name)===l.name)?"string":c})(l)===e,n=e=>l=>typeof l===e,l=t("string"),a=t("object"),c=t("array"),i=e=>null===e,h=n("boolean"),s=e=>null!=e,f=n("function"),u=(e,l)=>{if(c(e)){for(let a=0,c=e.length;a<c;++a)if(!l(e[a]))return!1;return!0}return!1},g=()=>{},d=(e,l)=>e===l;let m=class m{constructor(e,l){this.tag=e,this.value=l}static some(e){return new m(!0,e)}static none(){return m.singletonNone}fold(e,l){return this.tag?l(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?m.some(e(this.value)):m.none()}bind(e){return this.tag?e(this.value):m.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:m.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw Error(null!=e?e:"Called getOrDie on None")}static from(e){return s(e)?m.some(e):m.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}};m.singletonNone=new m(!1);let _=Array.prototype.indexOf,w=Array.prototype.push,p=e=>{let l=[];for(let a=0,h=e.length;a<h;++a){if(!c(e[a]))throw Error("Arr.flatten item "+a+" was not an array, input: "+e);w.apply(l,e[a])}return l},k=(e,l)=>{for(let a=0;a<e.length;a++){let c=l(e[a],a);if(c.isSome())return c}return m.none()},v=(e,l,a=d)=>e.exists(e=>a(e,l)),x=e=>{let l=[],n=e=>{l.push(e)};for(let l=0;l<e.length;l++)e[l].each(n);return l},y=(e,l)=>e?m.some(l):m.none(),b=e=>l=>l.options.get(e),C=b("link_assume_external_targets"),O=b("link_context_toolbar"),A=b("link_list"),N=b("link_default_target"),S=b("link_default_protocol"),E=b("link_target_list"),T=b("link_rel_list"),P=b("link_class_list"),R=b("link_title"),L=b("allow_unsafe_link_target"),j=b("link_quicklink");var U=tinymce.util.Tools.resolve("tinymce.util.Tools");let M=e=>l(e.value)?e.value:"",D=(e,a)=>{let c=[];return U.each(e,e=>{let h=l(e.text)?e.text:l(e.title)?e.title:"";if(void 0!==e.menu){let l=D(e.menu,a);c.push({text:h,items:l})}else{let l=a(e);c.push({text:h,value:l})}}),c},B=(e=M)=>l=>m.from(l).map(l=>D(l,e)),I=e=>B(M)(e),K=(e,l)=>a=>({name:e,type:"listbox",label:l,items:a}),q=Object.keys,F=Object.hasOwnProperty,V=(e,l)=>F.call(e,l);var $=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),z=tinymce.util.Tools.resolve("tinymce.util.URI");let G=e=>s(e)&&"a"===e.nodeName.toLowerCase(),H=e=>G(e)&&!!Q(e),J=(e,l)=>{if(e.collapsed)return[];{let a=e.cloneContents(),c=a.firstChild,h=new $(c,a),f=[],_=c;do l(_)&&f.push(_);while(_=h.next());return f}},W=e=>/^\w+:/i.test(e),Q=e=>{var l,a;return null!==(a=null!==(l=e.getAttribute("data-mce-href"))&&void 0!==l?l:e.getAttribute("href"))&&void 0!==a?a:""},X=(e,l)=>{var a;let c=["noopener"],h=e?e.split(/\s+/):[],r=e=>e.filter(e=>-1===U.inArray(c,e)),f=l?(a=r(a=h)).length>0?a.concat(c):c:r(h);return f.length>0?U.trim(f.sort().join(" ")):""},Y=(e,l)=>le(l=l||te(e.selection.getRng())[0]||e.selection.getNode())?m.from(e.dom.select("a[href]",l)[0]):m.from(e.dom.getParent(l,"a[href]")),Z=(e,l)=>Y(e,l).isSome(),ee=(e,l)=>l.fold(()=>e.getContent({format:"text"}),e=>e.innerText||e.textContent||"").replace(/\uFEFF/g,""),te=e=>J(e,H),ne=e=>U.grep(e,H),oe=e=>ne(e).length>0,re=e=>{let l=e.schema.getTextInlineElements();if(Y(e).exists(e=>e.hasAttribute("data-mce-block")))return!1;let a=e.selection.getRng();return!!a.collapsed||0===J(a,e=>1===e.nodeType&&!G(e)&&!V(l,e.nodeName.toLowerCase())).length},le=e=>s(e)&&"FIGURE"===e.nodeName&&/\bimage\b/i.test(e.className),ie=(e,l,a)=>{var c,h;let f=e.selection.getNode(),_=Y(e,f),w=((e,l)=>{var a,c;let h={...l};if(0===T(e).length&&!L(e)){let e=X(h.rel,"_blank"===h.target);h.rel=e||null}return m.from(h.target).isNone()&&!1===E(e)&&(h.target=N(e)),h.href=(a=h.href,"http"!==(c=C(e))&&"https"!==c||W(a)?a:c+"://"+a),h})(e,(c=(e,l)=>(a[l].each(a=>{e[l]=a.length>0?a:null}),e),h={href:a.href},((e,l)=>{for(let a=0,c=e.length;a<c;a++)l(e[a],a)})(["title","rel","class","target"],(e,l)=>{h=c(h,e)}),h));e.undoManager.transact(()=>{a.href===l.href&&l.attach(),_.fold(()=>{((e,l,a,c)=>{let h=e.dom;le(l)?ge(h,l,c):a.fold(()=>{e.execCommand("mceInsertLink",!1,c)},l=>{e.insertContent(h.createHTML("a",c,h.encode(l)))})})(e,f,a.text,w)},l=>{e.focus(),a.text.each(e=>{V(l,"innerText")?l.innerText=e:l.textContent=e}),e.dom.setAttribs(l,w),e.selection.select(l)})})},ae=e=>{let{class:l,href:a,rel:c,target:h,text:f,title:_}=e;return((e,l)=>{var a,c;let h={};return a=(e,l)=>!1===i(e),c=(e,l)=>{h[l]=e},((e,l)=>{let a=q(e);for(let c=0,h=a.length;c<h;c++){let h=a[c];l(e[h],h)}})(e,(e,l)=>{(a(e,l)?c:g)(e,l)}),h})({class:l.getOrNull(),href:a,rel:c.getOrNull(),target:h.getOrNull(),text:f.getOrNull(),title:_.getOrNull()})},se=(e,l,a)=>{let c=((e,l)=>{let a=e.options.get,c={allow_html_data_urls:a("allow_html_data_urls"),allow_script_urls:a("allow_script_urls"),allow_svg_data_urls:a("allow_svg_data_urls")},h=l.href;return{...l,href:z.isDomSafe(h,"a",c)?h:""}})(e,a);e.hasPlugin("rtc",!0)?e.execCommand("createlink",!1,ae(c)):ie(e,l,c)},ce=e=>{e.hasPlugin("rtc",!0)?e.execCommand("unlink"):(e=>{e.undoManager.transact(()=>{let l=e.selection.getNode();le(l)?ue(e,l):(e=>{let l=e.dom,a=e.selection,c=a.getBookmark(),h=a.getRng().cloneRange(),f=l.getParent(h.startContainer,"a[href]",e.getBody()),_=l.getParent(h.endContainer,"a[href]",e.getBody());f&&h.setStartBefore(f),_&&h.setEndAfter(_),a.setRng(h),e.execCommand("unlink"),a.moveToBookmark(c)})(e),e.focus()})})(e)},ue=(e,l)=>{var a;let c=e.dom.select("img",l)[0];if(c){let h=e.dom.getParents(c,"a[href]",l)[0];h&&(null===(a=h.parentNode)||void 0===a||a.insertBefore(c,h),e.dom.remove(h))}},ge=(e,l,a)=>{var c;let h=e.select("img",l)[0];if(h){let l=e.create("a",a);null===(c=h.parentNode)||void 0===c||c.insertBefore(l,h),l.appendChild(h)}},de=(e,l)=>k(l,l=>{var a;return V(l,a="items")&&void 0!==l[a]&&null!==l[a]?de(e,l.items):y(l.value===e,l)}),me=(e,l)=>{let a={text:e.text,title:e.title},o=(e,c)=>{let h=("link"===c?l.link:"anchor"===c?l.anchor:m.none()).getOr([]);return((e,l,a,c)=>{let h=c[l],f=e.length>0;return void 0!==h?de(h,a).map(l=>({url:{value:l.value,meta:{text:f?e:l.text,attach:g}},text:f?e:l.text})):m.none()})(a.text,c,h,e)};return{onChange:(e,l)=>{let c=l.name;return"url"===c?(e=>{var l,c,h,f;let _=(l=e.url,y(a.text.length<=0,m.from(null===(c=l.meta)||void 0===c?void 0:c.text).getOr(l.value))),w=(h=e.url,y(a.title.length<=0,m.from(null===(f=h.meta)||void 0===f?void 0:f.title).getOr("")));return _.isSome()||w.isSome()?m.some({..._.map(e=>({text:e})).getOr({}),...w.map(e=>({title:e})).getOr({})}):m.none()})(e()):_.call(["anchor","link"],c)>-1?o(e(),c):(("text"===c||"title"===c)&&(a[c]=e()[c]),m.none())}}};var et=tinymce.util.Tools.resolve("tinymce.util.Delay");let fe=e=>{let l=e.href;return l.indexOf("@")>0&&-1===l.indexOf("/")&&-1===l.indexOf("mailto:")?m.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:e=>({...e,href:"mailto:"+l})}):m.none()},pe=(e,l)=>a=>{let c=a.href;return 1===e&&!W(c)||0===e&&/^\s*www(\.|\d\.)/i.test(c)?m.some({message:`The URL you entered seems to be an external link. Do you want to add the required ${l}:// prefix?`,preprocess:e=>({...e,href:l+"://"+c})}):m.none()},ke=e=>{let l=e.dom.select("a:not([href])"),a=p(((e,l)=>{let a=e.length,c=Array(a);for(let h=0;h<a;h++){let a=e[h];c[h]=l(a,h)}return c})(l,e=>{let l=e.name||e.id;return l?[{text:l,value:"#"+l}]:[]}));return a.length>0?m.some([{text:"None",value:""}].concat(a)):m.none()},ve=e=>{let l=P(e);return l.length>0?I(l):m.none()},xe=e=>{try{return m.some(JSON.parse(e))}catch(e){return m.none()}},ye=(e,l)=>{let a=T(e);if(a.length>0){let c=v(l,"_blank");return(!1===L(e)?B(e=>X(M(e),c)):I)(a)}return m.none()},en=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],_e=e=>{let l=E(e);return c(l)?I(l).orThunk(()=>m.some(en)):!1===l?m.none():m.some(en)},we=(e,l,a)=>{let c=e.getAttrib(l,a);return null!==c&&c.length>0?m.some(c):m.none()},Ce=(e,a)=>(e=>{let t=l=>e.convertURL(l.value||l.url||"","href"),a=A(e);return new Promise(e=>{l(a)?fetch(a).then(e=>e.ok?e.text().then(xe):Promise.reject()).then(e,()=>e(m.none())):f(a)?a(l=>e(m.some(l))):e(m.from(a))}).then(e=>e.bind(B(t)).map(e=>e.length>0?[{text:"None",value:""}].concat(e):e))})(e).then(l=>{let c=((e,l)=>{let a=e.dom,c=re(e)?m.some(ee(e.selection,l)):m.none(),h=l.bind(e=>m.from(a.getAttrib(e,"href"))),f=l.bind(e=>m.from(a.getAttrib(e,"target"))),_=l.bind(e=>we(a,e,"rel")),w=l.bind(e=>we(a,e,"class"));return{url:h,text:c,title:l.bind(e=>we(a,e,"title")),target:f,rel:_,linkClass:w}})(e,a);return{anchor:c,catalogs:{targets:_e(e),rels:ye(e,c.target),classes:ve(e),anchor:ke(e),link:l},optNode:a,flags:{titleEnabled:R(e)}}}),Oe=e=>{let l=(e=>{let l=Y(e);return Ce(e,l)})(e);l.then(l=>((e,l,a)=>{let c=e.anchor.text.map(()=>({name:"text",type:"input",label:"Text to display"})).toArray(),h=e.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],f=((e,l)=>{let a=e.anchor,c=a.url.getOr("");return{url:{value:c,meta:{original:{value:c}}},text:a.text.getOr(""),title:a.title.getOr(""),anchor:c,link:c,rel:a.rel.getOr(""),target:a.target.or(l).getOr(""),linkClass:a.linkClass.getOr("")}})(e,m.from(N(a))),_=e.catalogs,w=me(f,_);return{title:"Insert/Edit Link",size:"normal",body:{type:"panel",items:p([[{name:"url",type:"urlinput",filetype:"file",label:"URL",picker_text:"Browse links"}],c,h,x([_.anchor.map(K("anchor","Anchors")),_.rels.map(K("rel","Rel")),_.targets.map(K("target","Open link in...")),_.link.map(K("link","Link list")),_.classes.map(K("linkClass","Class"))])])},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:f,onChange:(e,{name:l})=>{w.onChange(e.getData,{name:l}).each(l=>{e.setData(l)})},onSubmit:l}})(l,a=>{let c=a.getData();if(!c.url.value)return ce(e),void a.close();let r=e=>m.from(c[e]).filter(a=>!v(l.anchor[e],a)),h={href:c.url.value,text:r("text"),target:r("target"),rel:r("rel"),class:r("linkClass"),title:r("title")},f={href:c.url.value,attach:void 0!==c.url.meta&&c.url.meta.attach?c.url.meta.attach:g};k([fe,pe(C(e),S(e))],e=>e(h)).fold(()=>Promise.resolve(h),l=>new Promise(a=>{((e,l,a)=>{let c=e.selection.getRng();et.setEditorTimeout(e,()=>{e.windowManager.confirm(l,l=>{e.selection.setRng(c),a(l)})})})(e,l.message,e=>{a(e?l.preprocess(h):h)})})).then(l=>{se(e,f,l)}),a.close()},e)).then(l=>{e.windowManager.open(l)})};var el=tinymce.util.Tools.resolve("tinymce.util.VK");let Ae=(e,l)=>e.dom.getParent(l,"a[href]"),Se=e=>Ae(e,e.selection.getStart()),Ee=(e,l)=>{if(l){let a=Q(l);if(/^#/.test(a)){let l=e.dom.select(a);l.length&&e.selection.scrollIntoView(l[0],!0)}else(e=>{let l=document.createElement("a");l.target="_blank",l.href=e,l.rel="noreferrer noopener";let a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),document.body.appendChild(l),l.dispatchEvent(a),document.body.removeChild(l)})(l.href)}},Te=e=>()=>{e.execCommand("mceLink",!1,{dialog:!0})},Re=e=>()=>{Ee(e,Se(e))},Pe=(e,l)=>(e.on("NodeChange",l),()=>e.off("NodeChange",l)),Le=e=>l=>{let n=()=>{l.setActive(!e.mode.isReadOnly()&&Z(e,e.selection.getNode())),l.setEnabled(e.selection.isEditable())};return n(),Pe(e,n)},Me=e=>l=>{let n=()=>{l.setEnabled(e.selection.isEditable())};return n(),Pe(e,n)},De=e=>l=>{let n=()=>l.setEnabled(1===(e.selection.isCollapsed()?ne(e.dom.getParents(e.selection.getStart())):te(e.selection.getRng())).length);return n(),Pe(e,n)},Be=e=>l=>{let a=e.dom.getParents(e.selection.getStart()),o=a=>{l.setEnabled((oe(a)||te(e.selection.getRng()).length>0)&&e.selection.isEditable())};return o(a),Pe(e,e=>o(e.parents))};e.add("link",e=>{(e=>{let c=e.options.register;c("link_assume_external_targets",{processor:e=>{let a=l(e)||h(e);return a?!0===e?{value:1,valid:a}:"http"===e||"https"===e?{value:e,valid:a}:{value:0,valid:a}:{valid:!1,message:"Must be a string or a boolean."}},default:!1}),c("link_context_toolbar",{processor:"boolean",default:!1}),c("link_list",{processor:e=>l(e)||f(e)||u(e,a)}),c("link_default_target",{processor:"string"}),c("link_default_protocol",{processor:"string",default:"https"}),c("link_target_list",{processor:e=>h(e)||u(e,a),default:!0}),c("link_rel_list",{processor:"object[]",default:[]}),c("link_class_list",{processor:"object[]",default:[]}),c("link_title",{processor:"boolean",default:!0}),c("allow_unsafe_link_target",{processor:"boolean",default:!1}),c("link_quicklink",{processor:"boolean",default:!1})})(e),e.ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:Te(e),onSetup:Le(e)}),e.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:Re(e),onSetup:De(e)}),e.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:()=>ce(e),onSetup:Be(e)}),e.ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:Re(e),onSetup:De(e)}),e.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onSetup:Me(e),onAction:Te(e)}),e.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:()=>ce(e),onSetup:Be(e)}),(e=>{e.ui.registry.addContextMenu("link",{update:l=>e.dom.isEditable(l)?oe(e.dom.getParents(l,"a"))?"link unlink openlink":"link":""})})(e),(e=>{let t=l=>{let a=e.selection.getNode();return l.setEnabled(Z(e,a)),g};e.ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:Le(e)},label:"Link",predicate:l=>O(e)&&Z(e,l),initValue:()=>Y(e).fold(()=>"",Q),commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:l=>{let a=e.selection.getNode();return l.setActive(Z(e,a)),Le(e)(l)},onAction:l=>{let a=l.getValue(),c=(l=>{let a=Y(e),c=re(e);if(a.isNone()&&c){let c=ee(e.selection,a);return y(0===c.length,l)}return m.none()})(a);se(e,{href:a,attach:g},{href:a,text:c,title:m.none(),rel:m.none(),target:m.none(),class:m.none()}),(e=>{e.selection.collapse(!1)})(e),l.hide()}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:t,onAction:l=>{ce(e),l.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:t,onAction:l=>{Re(e)(),l.hide()}}]})})(e),e.on("click",l=>{let a=Ae(e,l.target);a&&el.metaKeyPressed(l)&&(l.preventDefault(),Ee(e,a))}),e.on("keydown",l=>{if(!l.isDefaultPrevented()&&13===l.keyCode&&!0===l.altKey&&!1===l.shiftKey&&!1===l.ctrlKey&&!1===l.metaKey){let a=Se(e);a&&(l.preventDefault(),Ee(e,a))}}),(e=>{e.addCommand("mceLink",(l,a)=>{!0!==(null==a?void 0:a.dialog)&&j(e)?e.dispatch("contexttoolbar-show",{toolbarKey:"quicklink"}):Oe(e)})})(e),(e=>{e.addShortcut("Meta+K","",()=>{e.execCommand("mceLink")})})(e)})}();