!function(){"use strict";let e=t=>{let o=t;return{get:()=>o,set:t=>{o=t}}};var t=tinymce.util.Tools.resolve("tinymce.PluginManager");let n=t=>o=>(t=>{var o,m;let g=typeof t;return null===t?"null":"object"===g&&Array.isArray(t)?"array":"object"===g&&((o=String).prototype.isPrototypeOf(t)||(null===(m=t.constructor)||void 0===m?void 0:m.name)===o.name)?"string":g})(o)===t,r=t=>o=>typeof o===t,o=n("string"),m=n("array"),g=r("boolean"),f=r("number"),i=()=>{},c=t=>()=>t,p=c(!0),C=c("[~№|!-*+-\\/:;?@\\[-`{}\xa1\xab\xb7\xbb\xbf;\xb7՚-՟։֊־׀׃׆׳״؉؊،؍؛؞؟٪-٭۔܀-܍߷-߹࠰-࠾࡞।॥॰෴๏๚๛༄-༒༺-༽྅࿐-࿔࿙࿚၊-၏჻፡-፨᐀᙭᙮᚛᚜᛫-᛭᜵᜶។-៖៘-៚᠀-᠊᥄᥅᨞᨟᪠-᪦᪨-᪭᭚-᭠᯼-᯿᰻-᰿᱾᱿᳓‐-‧‰-⁃⁅-⁑⁓-⁞⁽⁾₍₎〈〉❨-❵⟅⟆⟦-⟯⦃-⦘⧘-⧛⧼⧽⳹-⳼⳾⳿⵰⸀-⸮⸰⸱、-〃〈-】〔-〟〰〽゠・꓾꓿꘍-꘏꙳꙾꛲-꛷꡴-꡷꣎꣏꣸-꣺꤮꤯꥟꧁-꧍꧞꧟꩜-꩟꫞꫟꯫﴾﴿︐-︙︰-﹒﹔-﹡﹣﹨﹪﹫！-＃％-＊，-／：；？＠［-］＿｛｝｟-･]");let h=class h{constructor(t,o){this.tag=t,this.value=o}static some(t){return new h(!0,t)}static none(){return h.singletonNone}fold(t,o){return this.tag?o(this.value):t()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?h.some(t(this.value)):h.none()}bind(t){return this.tag?t(this.value):h.none()}exists(t){return this.tag&&t(this.value)}forall(t){return!this.tag||t(this.value)}filter(t){return!this.tag||t(this.value)?this:h.none()}getOr(t){return this.tag?this.value:t}or(t){return this.tag?this:t}getOrThunk(t){return this.tag?this.value:t()}orThunk(t){return this.tag?this:t()}getOrDie(t){if(this.tag)return this.value;throw Error(null!=t?t:"Called getOrDie on None")}static from(t){return null==t?h.none():h.some(t)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(t){this.tag&&t(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}};h.singletonNone=new h(!1);var O=tinymce.util.Tools.resolve("tinymce.Env"),N=tinymce.util.Tools.resolve("tinymce.util.Tools");let S=Array.prototype.slice,F=Array.prototype.push,y=(t,o)=>{let m=t.length,g=Array(m);for(let f=0;f<m;f++){let m=t[f];g[f]=o(m,f)}return g},w=(t,o)=>{for(let m=0,g=t.length;m<g;m++)o(t[m],m)},b=(t,o)=>{for(let m=t.length-1;m>=0;m--)o(t[m],m)},v=(t,o)=>(t=>{let o=[];for(let g=0,f=t.length;g<f;++g){if(!m(t[g]))throw Error("Arr.flatten item "+g+" was not an array, input: "+t);F.apply(o,t[g])}return o})(y(t,o)),et=Object.hasOwnProperty,E=(t,o)=>et.call(t,o);"undefined"!=typeof window?window:Function("return this;")();let T=t=>{if(null==t)throw Error("Node cannot be null or undefined");return{dom:t}},k=(t,o)=>({element:t,offset:o}),A=(t,o)=>{((t,o)=>{let m=h.from(t.dom.parentNode).map(T);m.each(m=>{m.dom.insertBefore(o.dom,t.dom)})})(t,o),((t,o)=>{t.dom.appendChild(o.dom)})(o,t)},en=((t,o)=>{let n=o=>t(o)?h.from(o.dom.nodeValue):h.none();return{get:o=>{if(!t(o))throw Error("Can only get text value of a text node");return n(o).getOr("")},getOption:n,set:(o,m)=>{if(!t(o))throw Error("Can only set raw text value of a text node");o.dom.nodeValue=m}}})(t=>3===t.dom.nodeType),B=t=>en.get(t);var er=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker");let I=(t,o)=>t.isBlock(o)||E(t.schema.getVoidElements(),o.nodeName),R=(t,o)=>!t.isEditable(o),M=(t,o)=>!t.isBlock(o)&&E(t.schema.getWhitespaceElements(),o.nodeName),D=(t,o)=>((t,o)=>{let m=y(t.dom.childNodes,T);return m.length>0&&o<m.length?k(m[o],0):k(t,o)})(T(t),o),P=(t,o,m,g,f,p=!0)=>{let C=p?o(!1):m;for(;C;){let m=R(t,C);if(m||M(t,C)){if(m?g.cef(C):g.boundary(C))break;C=o(!0)}else{if(I(t,C)){if(g.boundary(C))break}else 3===C.nodeType&&g.text(C);if(C===f)break;C=o(!1)}}},W=(t,o,m,g,f)=>{var C;if(I(t,m)||R(t,m)||M(t,m)||"true"===t.getContentEditable(m)&&m.parentNode&&!t.isEditable(m.parentNode))return;let O=null!==(C=t.getParent(g,t.isBlock))&&void 0!==C?C:t.getRoot(),N=new er(m,O),S=f?N.next.bind(N):N.prev.bind(N);P(t,S,m,{boundary:p,cef:p,text:t=>{f?o.fOffset+=t.length:o.sOffset+=t.length,o.elements.push(T(t))}})},$=(t,o,m,g,f,p=!0)=>{let C=new er(m,o),O=[],N={sOffset:0,fOffset:0,elements:[]};W(t,N,m,o,!1);let c=()=>(N.elements.length>0&&(O.push(N),N={sOffset:0,fOffset:0,elements:[]}),!1);return P(t,C.next.bind(C),m,{boundary:c,cef:t=>(c(),f&&O.push(...f.cef(t)),!1),text:t=>{N.elements.push(T(t)),f&&f.text(t,N)}},g,p),g&&W(t,N,g,o,!0),c(),O},V=(t,o)=>{let m=D(o.startContainer,o.startOffset),g=m.element.dom,f=D(o.endContainer,o.endOffset),p=f.element.dom;return $(t,o.commonAncestorContainer,g,p,{text:(t,o)=>{t===p?o.fOffset+=t.length-f.offset:t===g&&(o.sOffset+=m.offset)},cef:o=>((t,o)=>{let m=S.call(t,0);return m.sort((t,o)=>{var m,g,f;return(m=t.elements[0].dom,g=o.elements[0].dom,f=Node.DOCUMENT_POSITION_PRECEDING,0!=(m.compareDocumentPosition(g)&f))?1:-1}),m})(v(((t,o)=>{let m=void 0===o?document:o.dom;return 1!==m.nodeType&&9!==m.nodeType&&11!==m.nodeType||0===m.childElementCount?[]:y(m.querySelectorAll(t),T)})("*[contenteditable=true]",T(o)),o=>{let m=o.dom;return $(t,m,m)}))},!1)},j=(t,o)=>o.collapsed?[]:V(t,o),z=(t,o)=>{let m=t.createRng();return m.selectNode(o),j(t,m)},U=(t,o)=>v(o,o=>{let m=o.elements,g=y(m,B).join(""),f=((t,o,m=0,g=t.length)=>{let f;let p=o.regex;p.lastIndex=m;let C=[];for(;f=p.exec(t);){let t=f[o.matchIndex],m=f.index+f[0].indexOf(t),O=m+t.length;if(O>g)break;C.push({start:m,finish:O}),p.lastIndex=O}return C})(g,t,o.sOffset,g.length-o.fOffset);return((t,o)=>{var m,g;let f=(m=(t,m)=>{let g=B(m),f=t.last,p=f+g.length,C=v(o,(t,o)=>t.start<p&&t.finish>f?[{element:m,start:Math.max(f,t.start)-f,finish:Math.min(p,t.finish)-f,matchId:o}]:[]);return{results:t.results.concat(C),last:p}},g={results:[],last:0},w(t,(t,o)=>{g=m(g,t)}),g).results;return((t,o)=>{if(0===t.length)return[];{let m=o(t[0]),g=[],f=[];for(let p=0,C=t.length;p<C;p++){let C=t[p],O=o(C);O!==m&&(g.push(f),f=[]),m=O,f.push(C)}return 0!==f.length&&g.push(f),g}})(f,t=>t.matchId)})(m,f)}),_=(t,m)=>{b(t,(t,p)=>{b(t,t=>{let C=T(m.cloneNode(!1));((t,m,p)=>{if(!(o(p)||g(p)||f(p)))throw console.error("Invalid call to Attribute.set. Key ",m,":: Value ",p,":: Element ",t),Error("Attribute value was not simple");t.setAttribute(m,p+"")})(C.dom,"data-mce-index",p);let O=t.element.dom;if(O.length===t.finish&&0===t.start)A(t.element,C);else{O.length!==t.finish&&O.splitText(t.finish);let o=O.splitText(t.start);A(T(o),C)}})})},q=t=>t.getAttribute("data-mce-index"),G=(t,o,m,g)=>{let f=t.dom.create("span",{"data-mce-bogus":1});f.className="mce-match-marker";let p=t.getBody();return te(t,o,!1),g?((t,o,m,g)=>{let f=m.getBookmark(),p=t.select("td[data-mce-selected],th[data-mce-selected]"),C=p.length>0?v(p,o=>z(t,o)):j(t,m.getRng()),O=U(o,C);return _(O,g),m.moveToBookmark(f),O.length})(t.dom,m,t.selection,f):((t,o,m,g)=>{let f=z(t,m),p=U(o,f);return _(p,g),p.length})(t.dom,m,p,f)},K=t=>{var o;let m=t.parentNode;t.firstChild&&m.insertBefore(t.firstChild,t),null===(o=t.parentNode)||void 0===o||o.removeChild(t)},H=(t,o)=>{let m=[],g=N.toArray(t.getBody().getElementsByTagName("span"));if(g.length)for(let t=0;t<g.length;t++){let f=q(g[t]);null!==f&&f.length&&f===o.toString()&&m.push(g[t])}return m},J=(t,o,m)=>{let g=o.get(),f=g.index,p=t.dom;m?f+1===g.count?f=0:f++:f-1==-1?f=g.count-1:f--,p.removeClass(H(t,g.index),"mce-match-marker-selected");let C=H(t,f);return C.length?(p.addClass(H(t,f),"mce-match-marker-selected"),t.selection.scrollIntoView(C[0]),f):-1},L=(t,o)=>{let m=o.parentNode;t.remove(o),m&&t.isEmpty(m)&&t.remove(m)},Q=(t,o,m,g,f,p)=>{let N=t.selection,S=((t,o)=>{let m="("+t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&").replace(/\s/g,"[^\\S\\r\\n\\uFEFF]")+")";return o?`(?:^|\\s|${C()})`+m+`(?=$|\\s|${C()})`:m})(m,f),F=N.isForward(),et={regex:new RegExp(S,g?"g":"gi"),matchIndex:1},en=G(t,o,et,p);if(O.browser.isSafari()&&N.setRng(N.getRng(),F),en){let C=J(t,o,!0);o.set({index:C,count:en,text:m,matchCase:g,wholeWord:f,inSelection:p})}return en},X=(t,o)=>{let m=J(t,o,!0);o.set({...o.get(),index:m})},Y=(t,o)=>{let m=J(t,o,!1);o.set({...o.get(),index:m})},Z=t=>{let o=q(t);return null!==o&&o.length>0},ee=(t,o,m,g,f)=>{let p=o.get(),C=p.index,O,S=C;g=!1!==g;let F=t.getBody(),et=N.grep(N.toArray(F.getElementsByTagName("span")),Z);for(let o=0;o<et.length;o++){let N=q(et[o]),F=O=parseInt(N,10);if(f||F===p.index){for(m.length?(et[o].innerText=m,K(et[o])):L(t.dom,et[o]);et[++o];){if((F=parseInt(q(et[o]),10))!==O){o--;break}L(t.dom,et[o])}g&&S--}else O>C&&et[o].setAttribute("data-mce-index",String(O-1))}return o.set({...p,count:f?0:p.count-1,index:S}),g?X(t,o):Y(t,o),!f&&o.get().count>0},te=(t,o,m)=>{let g,f;let p=o.get(),C=N.toArray(t.getBody().getElementsByTagName("span"));for(let t=0;t<C.length;t++){let o=q(C[t]);null!==o&&o.length&&(o===p.index.toString()&&(g||(g=C[t].firstChild),f=C[t].firstChild),K(C[t]))}if(o.set({...p,index:-1,count:0,text:""}),g&&f){let o=t.dom.createRng();return o.setStart(g,0),o.setEnd(f,f.data.length),!1!==m&&t.selection.setRng(o),o}},ne=(t,o)=>{let m=(()=>{let t=(t=>{let o=e(h.none()),r=()=>o.get().each(t);return{clear:()=>{r(),o.set(h.none())},isSet:()=>o.get().isSome(),get:()=>o.get(),set:t=>{r(),o.set(h.some(t))}}})(i);return{...t,on:o=>t.get().each(o)}})();t.undoManager.add();let g=N.trim(t.selection.getContent({format:"text"})),s=t=>{t.setEnabled("next",o.get().count>1),t.setEnabled("prev",o.get().count>1)},a=(t,o)=>{w(["replace","replaceall","prev","next"],m=>t.setEnabled(m,!o))},l=(t,o)=>{o.redial(y(t,o.getData()))},c=(t,o)=>{O.browser.isSafari()&&O.deviceType.isTouch()&&("find"===o||"replace"===o||"replaceall"===o)&&t.focus(o)},d=m=>{te(t,o,!1),a(m,!0),s(m)},u=m=>{let g=m.getData(),f=o.get();if(g.findtext.length){if(f.text===g.findtext&&f.matchCase===g.matchcase&&f.wholeWord===g.wholewords)X(t,o);else{let f=Q(t,o,g.findtext,g.matchcase,g.wholewords,g.inselection);f<=0&&l(!0,m),a(m,0===f)}s(m)}else d(m)},f=o.get(),p={findtext:g,replacetext:"",wholewords:f.wholeWord,matchcase:f.matchCase,inselection:f.inSelection},x=t=>{let o=[{type:"bar",items:[{type:"input",name:"findtext",placeholder:"Find",maximized:!0,inputMode:"search"},{type:"button",name:"prev",text:"Previous",icon:"action-prev",enabled:!1,borderless:!0},{type:"button",name:"next",text:"Next",icon:"action-next",enabled:!1,borderless:!0}]},{type:"input",name:"replacetext",placeholder:"Replace with",inputMode:"search"}];return t&&o.push({type:"alertbanner",level:"error",text:"Could not find the specified string.",icon:"warning"}),o},y=(m,g)=>({title:"Find and Replace",size:"normal",body:{type:"panel",items:x(m)},buttons:[{type:"menu",name:"options",icon:"preferences",tooltip:"Preferences",align:"start",items:[{type:"togglemenuitem",name:"matchcase",text:"Match case"},{type:"togglemenuitem",name:"wholewords",text:"Find whole words only"},{type:"togglemenuitem",name:"inselection",text:"Find in selection"}]},{type:"custom",name:"find",text:"Find",primary:!0},{type:"custom",name:"replace",text:"Replace",enabled:!1},{type:"custom",name:"replaceall",text:"Replace all",enabled:!1}],initialData:g,onChange:(t,g)=>{m&&l(!1,t),"findtext"===g.name&&o.get().count>0&&d(t)},onAction:(m,g)=>{let f=m.getData();switch(g.name){case"find":u(m);break;case"replace":ee(t,o,f.replacetext)?s(m):d(m);break;case"replaceall":ee(t,o,f.replacetext,!0,!0),d(m);break;case"prev":Y(t,o),s(m);break;case"next":X(t,o),s(m);break;case"matchcase":case"wholewords":case"inselection":l(!1,m),(t=>{let m=t.getData(),g=o.get();o.set({...g,matchCase:m.matchcase,wholeWord:m.wholewords,inSelection:m.inselection})})(m),d(m)}c(m,g.name)},onSubmit:t=>{u(t),c(t,"find")},onClose:()=>{t.focus(),te(t,o),t.undoManager.add()}});m.set(t.windowManager.open(y(!1,p),{inline:"toolbar"}))},re=(t,o)=>()=>{ne(t,o)};t.add("searchreplace",t=>{let o=e({index:-1,count:0,text:"",matchCase:!1,wholeWord:!1,inSelection:!1});return((t,o)=>{t.addCommand("SearchReplace",()=>{ne(t,o)})})(t,o),t.ui.registry.addMenuItem("searchreplace",{text:"Find and replace...",shortcut:"Meta+F",onAction:re(t,o),icon:"search"}),t.ui.registry.addButton("searchreplace",{tooltip:"Find and replace",onAction:re(t,o),icon:"search"}),t.shortcuts.add("Meta+F","",re(t,o)),{done:m=>te(t,o,m),find:(m,g,f,p=!1)=>Q(t,o,m,g,f,p),next:()=>X(t,o),prev:()=>Y(t,o),replace:(m,g,f)=>ee(t,o,m,g,f)}})}();